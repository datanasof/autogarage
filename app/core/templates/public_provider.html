
{% extends 'base.html' %}
{% block content %}
  {% if error %}
    <div class="container"><p style="color:crimson;">{{ error }}</p></div>
  {% else %}
  <div class="container">
    <h2>{{ provider.company_name }}</h2>
    <p>{{ provider.description }}</p>
    <p><strong>Phone:</strong> {{ provider.phone }} &nbsp; <strong>Email:</strong> {{ provider.email }} &nbsp; <strong>Address:</strong> {{ provider.address }}</p>

    <h3>Calendar (open time in green)</h3>
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.20/main.min.css' rel='stylesheet' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.20/index.global.min.js'></script>
    <div id='calendar'></div>

    <h3 style="margin-top:1rem;">Location</h3>
    <div id="map" class="map"></div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function(){
      const cal = new FullCalendar.Calendar(document.getElementById('calendar'), {
        initialView: 'timeGridWeek',
        events: { url: '/api/providers/{{ provider.slug }}/calendar/' }
      });
      cal.render();
    });
    function initMap(){
      const hasLat = {{ provider.latitude|yesno:'true,false' }};
      const hasLng = {{ provider.longitude|yesno:'true,false' }};
      const has = hasLat && hasLng;
      const lat = parseFloat('{{ provider.latitude|default:42.6977 }}');
      const lng = parseFloat('{{ provider.longitude|default:23.3219 }}');
      const center = {lat: lat, lng: lng};
      const map = new google.maps.Map(document.getElementById('map'), { center, zoom: has ? 14 : 6 });
      if (has){ new google.maps.Marker({position: center, map}); }
    }
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key={{ GOOGLE_MAPS_API_KEY }}&callback=initMap"></script>
  {% endif %}
{% endblock %}
